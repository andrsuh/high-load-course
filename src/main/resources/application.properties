server.address=0.0.0.0
server.port=8081
server.http2.enabled=true

# Jetty configuration for high load (case 9: 1000 RPS)
# Increase threads to handle incoming HTTP requests efficiently
server.jetty.threads.max=500
server.jetty.threads.min=100
server.jetty.threads.max-queue-capacity=10000
server.jetty.threads.idle-timeout=60000
server.jetty.connection-idle-timeout=30000
# ????????: acceptors ? selectors ??? ????????? ???????? ??????????
# acceptors - ????????? ????? ??????????, selectors - ???????????? I/O
server.jetty.acceptors=8
server.jetty.selectors=16

spring.main.allow-bean-definition-overriding=true

# MongoDB properties
spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=online-shop

# Tiny event sourcing library properties
event.sourcing.auto-scan-enabled=true
event.sourcing.scan-package=ru.quipy
event.sourcing.snapshots-enabled=false
event.sourcing.sagas-enabled=false

# Postgres event store properties
spring.datasource.hikari.jdbc-url=jdbc:postgresql://${POSTGRES_ADDRESS:localhost}:${POSTGRES_PORT:65432}/postgres
spring.datasource.hikari.username=tiny_es
spring.datasource.hikari.password=tiny_es
spring.datasource.hikari.leak-detection-threshold=2000

# HikariCP configuration for high load (case 9: 1000 RPS)
# With 20,000 threads and ~3000-4000 DB ops/sec, need MUCH larger pool
# ?????? payment ?????? 3-4 ?????? ? ?? ????? Event Sourcing
# ???????????: PostgreSQL max_connections=200, ??????? ?????? 180 (????????? ?????)
spring.datasource.hikari.maximum-pool-size=180
spring.datasource.hikari.minimum-idle=90
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

management.metrics.web.server.request.autotime.percentiles=0.95
management.metrics.export.prometheus.enabled=true
management.endpoints.web.exposure.include=info,health,prometheus,metrics

payment.service-name=${PAYMENT_SERVICE_NAME}
payment.token=${PAYMENT_TOKEN}
payment.accounts=${PAYMENT_ACCOUNTS:acc-12}
payment.hostPort=${PAYMENT_HOST:localhost}:${PAYMENT_PORT:1234}